Ниже — последовательное текстовое описание основных блоков проекта и их взаимосвязей. Это своего рода «логическая схема» на словах, где мы прослеживаем путь пользователя и логику приложения:

1. Точка входа в приложение (RootLayout)
	1.	RootLayout (app/layout.tsx):
	•	Подключает глобальные стили, шрифты, фон и провайдер контекста аутентификации (AuthProvider).
	•	Любые страницы и компоненты внутри будут обернуты этим лейаутом, который, в частности, обеспечивает доступ к контексту аутентификации.
	2.	Главная страница (app/page.tsx):
	•	Выполняет немедленный redirect на /dashboard, чтобы при заходе на / пользователь шел в личный кабинет.

2. Аутентификация пользователя

2.1 Регистрация
	1.	Страница регистрации (app/register/page.tsx)
	•	Показывает форму RegisterForm (из components/auth/RegisterForm.tsx).
	•	Пользователь вводит данные (имя, фамилия, email, пароль).
	•	Проверка, что пользователь еще не авторизован; если сессия есть — сразу перенаправляет в /dashboard.
	•	Вызов Supabase auth.signUp, сохранение профиля в таблицу profiles.
	•	Если регистрация успешна, пользователю отправляется письмо верификации на email.

2.2 Вход в систему
	1.	Страница логина (app/login/page.tsx)
	•	Показывает форму LoginForm (из components/auth/LoginForm.tsx).
	•	При вводе корректных email/пароля вызывается supabase.auth.signInWithPassword.
	•	Если авторизация прошла, проверяется наличие user_metadata. Если имя не заполнено — перенаправление на /complete-profile.
	•	Иначе пользователь перенаправляется на /dashboard.
	•	В случае «Забыли пароль?» — отправляется линк на сброс пароля (resetPasswordForEmail).

2.3 Колбэк авторизации (app/auth/callback/page.tsx)
	•	После подтверждения email при регистрации (или при другом схожем сценарии) Supabase вернёт пользователя на этот URL.
	•	Получает текущую сессию через supabase.auth.getSession().
	•	Если пользователь не завершил профиль (нет first_name в user_metadata) — идёт переадресация на /complete-profile.
	•	Иначе — на /dashboard.

2.4 Завершение профиля (app/complete-profile/page.tsx)
	•	Форма CompleteProfileForm запрашивает у пользователя имя и фамилию.
	•	Обновляет user_metadata в Supabase (через supabase.auth.updateUser).
	•	После сохранения перенаправляет в /dashboard.

2.5 Сброс пароля (app/reset-password/page.tsx)
	•	Если пользователь получил ссылку для сброса (по email), она ведёт на /reset-password.
	•	Страница ResetPassword проверяет наличие ошибок в URL (например, «link expired»).
	•	Позволяет ввести новый пароль и подтверждение.
	•	После успешного обновления пароля перенаправляет на /login.

3. Главное рабочее пространство (Dashboard)

3.1 Лейаут для /dashboard (app/dashboard/layout.tsx)
	•	Обёртка «DashboardLayout», которая:
	•	Проверяет аутентификацию через контекст useAuth. Если пользователь не авторизован, идёт перенаправление на /login.
	•	Показывает шапку, где размещён логотип и компонент UserProfile.
	•	Внутри шапки — проверка роли пользователя и другие элементы.
	•	Дети (children) этого лейаута — это непосредственно страницы внутри /dashboard.

3.2 Страница /dashboard (app/dashboard/page.tsx)
	•	Получает текущего юзера из useAuth.
	•	Запрашивает из таблицы profiles роль пользователя (супервайзер, CFO, CEO и т.д.).
	•	Если роль CFO или SUPPLY_MANAGER, автоматически показывается раздел «Invoices».
	•	Для других ролей есть разные секции (Projects, Budgets, Salaries, Invoices) — рендерятся в зависимости от нажатых вкладок или ролей.
	•	Внизу виден BottomNav (небольшая навигация) для переключения разделов, кроме CFO, у которого этот BottomNav скрыт.

4. Компоненты разделов дашборда
	1.	ProjectsSection (примерно в components/dashboard/sections/ProjectsSection.tsx):
	•	Отвечает за вывод списка проектов, возможно, с кнопкой добавления нового проекта (через CreateProjectDialog).
	•	Показывает возможность просмотра/редактирования проекта.
	2.	BudgetsSection / SalariesSection / InvoicesSection:
	•	Аналогичные компоненты, каждый отвечает за свою зону (себестоимости, зарплаты, счета).
	•	InvoicesSection, например, позволяет просматривать и загружать счета (Invoices).

5. Управление проектами

5.1 Создание проекта
	•	CreateProjectDialog (из components/projects/CreateProjectDialog.tsx)
	•	Модальное окно, в которое передаётся callback onSuccess.
	•	Пользователь вводит номер, название, себестоимость, дату и выбирает менеджера (из роли MANAGER или CEO).
	•	Посылается insert в таблицу projects через Supabase.

5.2 Просмотр/редактирование проекта
	•	ProjectViewDialog (из components/projects/ProjectViewDialog.tsx)
	•	Модальное окно с деталями проекта (название, номер, заказчик, себестоимость, менеджер, статус и т.д.).
	•	Подтягивает данные о назначенном менеджере, а также загруженные счета (через InvoicesSection) и итоги по себестоимости.
	•	Для роли CEO доступно редактирование проекта:
	•	EditProjectDialog позволяет менять поля (имя, себестоимость, менеджера, статус и др.), отправляет update в таблицу projects.
	•	Также тут может быть кнопка загрузки счетов или других документов (через InvoiceUploadDialog).

6. Работа со счетами (Invoices)
	1.	InvoiceUploadDialog (из components/projects/InvoiceUploadDialog.tsx)
	•	Даёт возможность прикрепить счет к проекту, загрузив файл в хранилище Supabase и записав метаданные в таблицу (например, invoices).
	•	После успешной загрузки обновляется список счетов.
	2.	InvoicesSection (как упомянуто выше)
	•	Показывает список счетов, подсчитывает сумму, меняет статус.
	•	Вызывает onTotalAmountChange для пересчёта фактически использованной себестоимости.

7. Контекст аутентификации (AuthContext)
	1.	AuthProvider (из contexts/AuthContext.tsx или аналогично)
	•	Хранит состояние текущего пользователя, загрузку (loading), методы для логина/логаута.
	•	Подписывается на события supabase.auth.onAuthStateChange, что позволяет обновлять интерфейс при изменении сессии.
	2.	useAuth() (хук из AuthContext)
	•	Позволяет любому компоненту получить user, loading, signIn, signOut, и т.д.

8. Итоговая логика взаимодействия
	1.	Посетитель попадает на / → мгновенный редирект к /dashboard.
	2.	Если не авторизован, в лейауте дашборда происходит проверка → отправляем на /login.
	3.	При логине/регистрации проверяется, заполнены ли поля профиля (first_name/last_name). Если нет — /complete-profile.
	4.	После авторизации рендерится /dashboard:
	•	Секция «Projects» по умолчанию для обычного пользователя / роли MANAGER.
	•	Секция «Invoices» по умолчанию, если роль CFO или SUPPLY_MANAGER.
	•	При необходимости пользователь может переключаться на Budgets, Salaries, и т.д. (если роль позволяет).
	5.	В «Projects» мы можем открыть CreateProjectDialog (если достаточно прав) → вставка новой записи в Supabase.
	6.	На карточке проекта — «Посмотреть» → открывается ProjectViewDialog.
	•	Там видим детали, менеджера, список счетов.
	•	Роль CEO может нажать «Редактировать» → открывается EditProjectDialog.
	•	Можно загрузить счёт → InvoiceUploadDialog.
	•	Суммы счетов влияют на остаток себестоимости.
	7.	При «Выйти» из системы в любом месте → происходит signOut, контекст аутентификации сбрасывается → дальше редирект на /login.

Так выглядит текстовая логическая карта ключевых блоков и страниц приложения, а также их взаимодействие друг с другом.


Company Logo
ТЕХНИЧЕСКОЕ ЗАДАНИЕ
Проект: Веб-приложение EG Production

Версия документа: 1.0

Дата: 15.01.2025

Сроки исполнения: 14 рабочих дней

1. Введение

Настоящее техническое задание (ТЗ) разработано для создания веб-приложения EG Production, предназначенного для управления документооборотом и финансами в рамках проектов компании. Приложение будет поддерживать четыре основные роли пользователей: Manager, CEO, CFO и Supply Manager.

2. Цели и Задачи

Управление документооборотом и финансами в рамках проектов
Обеспечение структурированного доступа к данным с ограничением по ролям
Своевременное отслеживание перерасходов по проектам
Автоматизация процесса подачи и обработки счетов на оплату
3. Пользовательские Роли и Функциональные Требования

3.1. Роли Пользователей

Manager
CEO
CFO
Supply Manager
3.2. Общие Требования для Всех Пользователей

Аутентификация:
Вход в приложение по логину и паролю
Восстановление пароля через email
3.3. Функциональные Требования по Ролям

3.3.1. Manager

Просмотр назначенных проектов на дашборде:
Список проектов, где пользователь назначен менеджером
Возможность перехода в карточку проекта
Управление счетами в рамках проекта:
При добавлении счета из карточки проекта:
Категория автоматически устанавливается как "Себестоимость"
Номер проекта предустановлен
Возможность массовой загрузки счетов с общими параметрами:
Комментарий
Дата оплаты (обязательно)
Флаг срочности (опционально)
Просмотр финансовой информации:
Инфографика с отображением:
Общая себестоимость проекта
Сумма поданных счетов
Визуализация остатка/перерасхода
Управление закрывающими документами:
Возможность добавления только при наличии счетов
Привязка к существующим счетам проекта
3.3.2. CFO

Управление статусами счетов
Управление платежами:
При оплате подгружать несколько платежных документов
Фильтрация счетов:
По статусам счетов
По срочности
По менеджеру
По дате оплаты
По проекту
Просмотр и управление всеми счетами
3.3.3. CEO

Управление проектами:
Создание нового проекта:
Название проекта
Описание
Заказчик
Сроки исполнения
Установка себестоимости
Назначение менеджера проекта
Возможность установки статуса менеджера "anyone":
Проект становится доступен всем пользователям
Любой пользователь может загружать счета
Управление себестоимостью по проектам
Пометка о закрытии проекта:
Обновление статусов по проектам:
В работе
Реализован
Завершен
Отменен
Просмотр всех счетов по всем проектам
Назначение менеджера по проекту
Возможность выступать в роли менеджера по проекту
Назначение менеджера "anyone" для проекта:
Проект будет отображаться во всех выпадающих списках пользователей
Любой пользователь может загрузить счет в этот проект
3.3.4. Supply Manager

Входит в приложение (логин/пароль)
Может загружать новые счета в любой проект:
Аналогично менеджеру, указывает категорию (включая «Себестоимость отдела» с подпунктами EG, Brand Group, Imagineers), номер проекта, информацию о платеже, файлы (multiple), комментарии при необходимости
В системе видит только свои собственные счета (остальные ему недоступны)
4. Управление Закрывающими Документами

Привязка к проекту:
Закрывающие документы связаны с конкретным проектом
Загрузка закрывающих документов:
Открытие диалогового окна для загрузки файлов (поддержка множественной загрузки)
Поле для добавления комментария (опционально)
Выбор счетов, к которым относятся документы (выбор из списка счетов проекта)
Привязка к счетам:
Выбор счетов для привязки документов из списка счетов проекта
Присвоение счету специального маркера при наличии закрывающих документов
Просмотр закрывающих документов:
Менеджеры видят все закрывающие документы по проектам, к которым они назначены (включая проекты с пометкой "anyone")
Снабженец видит закрывающие документы только по своим счетам, если они к ним были привязаны
5. Интерфейс Пользователя

Авторизация:
Форма входа с полями логин и пароль
Ссылка на восстановление пароля
Основные Разделы:
Дашборд:
Список назначенных проектов
Быстрый доступ к карточкам проектов
Инфографика по проектам
Карточка проекта:
Основная информация о проекте
Визуализация себестоимости:
Общая себестоимость
Сумма поданных счетов
Остаток/перерасход
Кнопки действий:
Добавить счет (автоматически в категории "Себестоимость")
Добавить закрывающие документы (активна при наличии счетов)
Форма добавления счетов:
Общие параметры для всех загружаемых счетов:
Комментарий
Дата оплаты (обязательно)
Флаг срочности
Область загрузки файлов (multiple)
Форма добавления закрывающих документов:
Список доступных счетов проекта
Область загрузки файлов (multiple)
Поле комментария
6. Технические Требования

Архитектура:
Тип приложения: Веб-приложение
Архитектурный стиль: Клиент-серверная архитектура
Поддерживаемые браузеры: Chrome, Firefox, Safari, Edge
Технологии:
Фронтенд: HTML5, CSS3, JavaScript (React.js или Vue.js)
Бэкенд: Python (Django/Flask) или Node.js
База данных: PostgreSQL или MySQL
Безопасность:
Шифрование паролей (например, bcrypt)
HTTPS для всех соединений
Ролевое разграничение доступа
Защита от SQL-инъекций, XSS и других уязвимостей
Хранение файлов:
Локальное хранилище сервера или облачные сервисы (например, AWS S3)
Производительность:
Быстрая загрузка страниц
Оптимизация запросов к базе данных
Масштабируемость для увеличения числа пользователей и данных
Отказоустойчивость:
Регулярное резервное копирование базы данных
Механизмы восстановления после сбоев
7. Нефункциональные Требования

Юзабилити:
Интуитивно понятный интерфейс
Адаптивный дизайн для различных устройств (ПК, планшеты, смартфоны)
Локализация:
Интерфейс на русском языке
Возможность добавления других языков в будущем
Поддержка и обслуживание:
Документация по использованию приложения для всех ролей пользователей
Техническая поддержка для решения возникающих проблем
8. Этапы Разработки

Сбор и анализ требований:
Уточнение деталей функционала для всех ролей, включая Supply Manager
Дополнительное обсуждение подкатегорий при подаче счета "Себестоимость отдела"
Проектирование архитектуры:
Выбор стека технологий
Проектирование базы данных и API
Разработка прототипа:
Создание макетов интерфейса
Сбор обратной связи от конечных пользователей
Разработка основного функционала:
Реализация функций для всех ролей
Интеграция загрузки и привязки файлов
Реализация подкатегорий при выборе "Себестоимость отдела"
Тестирование:
Функциональное тестирование
Тестирование безопасности
Юзабилити-тестирование
Внедрение:
Развертывание приложения на сервере
Обучение пользователей
Поддержка и обновления:
Регулярное обновление системы
Внедрение новых функций по мере необходимости
9. Требования к Документации

Пользовательская документация:
Руководство пользователя для каждой роли
Техническая документация:
Документация по архитектуре системы
API документация
10. Заключение

Веб-приложение EG Production станет эффективным инструментом для управления финансами и проектами компании, обеспечивая автоматизацию процессов, прозрачность и удобство использования для всех ролей пользователей. Важно обеспечить надежную безопасность, масштабируемость и интуитивно понятный интерфейс для достижения максимальной эффективности работы компании.
